var ct=Object.defineProperty;var gt=(r,t,e)=>t in r?ct(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var F=(r,t,e)=>(gt(r,typeof t!="symbol"?t+"":t,e),e);import{S as rt,i as st,s as it,k,a as C,l as S,m as O,h as w,c as P,n as x,Q as v,b as T,F as b,N as I,J as Y,R as H,O as ot,o as dt,T as mt,w as A,y as nt,D as pt,z as lt,A as at,g as ut,d as ht,B as ft,K as _t,q as J,r as K}from"../chunks/index.7afe130e.js";import{p as xt}from"../chunks/stores.a6badc3d.js";import{S as yt}from"../chunks/section.0a8929ca.js";const wt=""+new URL("../assets/photo-1687057217908-54f8e6d30e3c.fad614f4.avif",import.meta.url).href;function M(r,t){return U(r,t,(e,s)=>e+s)}function E(r,t){return U(r,t,(e,s)=>e-s)}function Dt(r,t){return U(r,t,(e,s)=>e/s)}function vt(r){return Ft(r,Math.round)}function N(r,t){return r.x==t.x&&r.y==t.y}function Ft(r,t){return{x:t(r.x),y:t(r.y)}}function U(r,t,e){return{x:e(r.x,t.x),y:e(r.y,t.y)}}function bt(r){let t=r.length,e;for(;t!=0;)e=Math.floor(Math.random()*t),t--,[r[t],r[e]]=[r[e],r[t]]}class kt{constructor(t,e,s){F(this,"matrix");F(this,"initial");F(this,"current");F(this,"drag");this.matrix=s,this.initial={x:t,y:e},this.current={x:t,y:e},this.drag={from:null,to:null}}get rows(){return this.matrix.rows}get cols(){return this.matrix.cols}get image(){return this.matrix.image}isDragFrom(){return this.drag.from!=null}isDragTo(){return this.drag.to!=null}originOrCurrent(){var t,e;return((t=this.drag.from)==null?void 0:t.originCurrent)??((e=this.drag.to)==null?void 0:e.originCurrent)??this.current}getNext(t){return this.matrix.tileByCurrent(M(this.current,t))}isOkWith(t){return N(E(t.current,this.current),E(t.initial,this.initial))}isOkWithNext(t){const e=this.getNext(t);return e?e.isOkWith(this):!0}setDragFrom(t){if(this.drag.from!=null)throw new Error("setDragFrom: from already set");if(this.drag.to!=null)throw new Error("setDragFrom: to already set");if(!this.matrix.options.getSlotPos(this.current,this.cols))throw new Error("setDragFrom: slot not found");this.drag.from={originCurrent:this.current,originMouse:t,pullOffset:{x:0,y:0}}}updateDragFrom(t){if(this.drag.from==null)throw new Error("updateDragFrom: from unset");const e=E(t,this.drag.from.originMouse);this.drag.from.pullOffset=e}unsetDragFrom(){if(this.drag.from==null)throw new Error("unsetDragFrom: from unset");this.drag.from=null}setDragTo(){if(this.drag.from!=null)throw new Error("setDragTo: from already set");if(this.drag.to!=null)throw new Error("setDragTo: to already set");this.drag.to={originCurrent:this.current}}unsetDragTo(){if(this.drag.to==null)throw new Error("unsetDragTo: to unset");this.current=this.drag.to.originCurrent,this.drag.to=null}style(){var l,c,a;const t=this.matrix.options.getGridSize(),e=this.matrix.options.getSlotPos(this.initial,this.cols);let s;this.isDragFrom()?s=this.originOrCurrent():s=this.current;const i=this.matrix.options.getSlotPos(s,this.cols),n=this.matrix.options.getSlotSize(s,this.cols);if(t&&e&&i&&n){let u={...e};u.x=Math.min(u.x,t.x-n.x),u.x=Math.max(u.x,0),u.x=u.x*-1,u.y=Math.min(u.y,t.y-n.y),u.y=Math.max(u.y,0),u.y=u.y*-1;const f=t;return`left: ${i.x+(((l=this.drag.from)==null?void 0:l.pullOffset.x)??0)}px; top: ${i.y+(((a=(c=this.drag.from)==null?void 0:c.pullOffset)==null?void 0:a.y)??0)}px; width: ${n.x}px; height: ${n.y}px;background-image: url(${this.image.url}); background-position: ${u.x}px ${u.y}px; background-size: ${f.x}px ${f.y}px ; `}}bgX(){return this.cols>1?100/(this.cols-1)*this.initial.x:0}bgY(){return this.rows>1?100/(this.rows-1)*this.initial.y:0}}function St(r,t){const e=Math.sqrt(t*r.y/r.x);return{x:Math.round(t/e),y:Math.round(e)}}const G={x:0,y:-1},R={x:0,y:1},L={x:-1,y:0},W={x:1,y:0},Ot=[G,R,L,W];class Tt{constructor(t){F(this,"options");F(this,"rows");F(this,"cols");F(this,"matrix",[]);F(this,"dragFrom",null);F(this,"dragTarget",null);this.options=t;let e=St(t.image.size,t.tileCount);this.cols=e.x,this.rows=e.y,this.matrix=[];for(let s=0;s<this.rows;s++)for(let i=0;i<this.cols;i++)this.matrix.push(new kt(i,s,this))}get image(){return this.options.image}*tiles(){for(const t of this.matrix)yield t}tileGroup(t){const e=new Set;function s(i){if(!e.has(i)){e.add(i);for(const n of Ot){const l=i.getNext(n);l&&i.isOkWith(l)&&s(l)}}}return s(t),e}tileByInitial(t){return this.isInRange(t)?this.matrix[t.y*this.cols+t.x]:null}isInRange(t){return t.x>=0&&t.x<this.cols&&t.y>=0&&t.y<this.rows}tileByCurrent(t){for(const e of this.matrix)if(N(e.current,t))return e;return null}tileByOriginCurrent(t){for(const e of this.matrix)if(N(e.originOrCurrent(),t))return e;return null}style(){return`aspect-ratio: ${this.image.size.x} / ${this.image.size.y}; grid-template-columns: repeat(${this.cols}, 1fr);`}shuffle(){const t=[...this.matrix.map(e=>({...e.current}))];bt(t);for(const e in this.matrix)this.matrix[e].current=t[e]}solveDrag(t,e){const s=[];if(e.x!=0||e.y!=0){const i=[];for(const n of t){const l=M(n.current,e);if(!this.isInRange(l))return[];i.push({pos:l,tile:n})}for(const{pos:n,tile:l}of i){s.push({tile:l,pos:n,isDragTo:!1});const c=this.tileByOriginCurrent(n);if(c&&!t.includes(c)){let a,u,f=l,h=0;do{a=f.originOrCurrent(),u=!0;for(const{pos:d,tile:o}of i)if(N(d,a)){u=!1,f=o;break}if(h++,h>1e3)throw new Error("infinite loop")}while(!u);s.push({tile:c,pos:a,isDragTo:!0})}}}return s}setDragFrom(t,e){const s=this.tileByOriginCurrent(t);if(s){const i=[...this.tileGroup(s)];this.dragFrom={startClient:e,startPos:t,currentPos:t,tiles:i,dragActions:[]},i.map(n=>n.setDragFrom(e))}}dragUpdate(t){var s;const e=this.options.getSlotSize(this.matrix[0].current,this.cols);if(e&&this.dragFrom){const i=E(t,this.dragFrom.startClient),n=vt(Dt(i,e)),l=M(this.dragFrom.startPos,n),c=E(l,this.dragFrom.currentPos);this.dragFrom.currentPos=l;const a=this.solveDrag(this.dragFrom.tiles,c);a.length!=0&&(this.dragFrom.dragActions.map(u=>{u.isDragTo&&u.tile.unsetDragTo()}),this.dragFrom.dragActions=a,this.dragFrom.dragActions.map(u=>{u.isDragTo?u.tile.setDragTo():u.tile.updateDragFrom(t),u.tile.current=u.pos})),(s=this.dragFrom)==null||s.tiles.map(u=>{u.updateDragFrom(t)})}}unsetDragFrom(){var t,e;(t=this.dragFrom)==null||t.tiles.map(s=>s.unsetDragFrom()),(e=this.dragFrom)==null||e.dragActions.map(s=>{s.isDragTo&&s.tile.unsetDragTo(),s.tile.current=s.pos}),this.dragFrom=null,this.dragTarget=null}}function $(r){const t=new Map;return{call:(...e)=>{const s=t.get(e);if(s)return s;{const i=r(...e);return t.set(e,i),i}},clear:()=>{t.clear()}}}const{window:Q}=mt;function Z(r,t,e){const s=r.slice();return s[15]=t[e],s}function j(r,t,e){const s=r.slice();return s[15]=t[e],s[18]=t,s[19]=e,s}function tt(r){let t,e,s,i=r[19];const n=()=>r[9](t,i),l=()=>r[9](null,i);return{c(){t=k("div"),this.h()},l(c){t=S(c,"DIV",{class:!0,"data-pos-x":!0,"data-pos-y":!0}),O(t).forEach(w),this.h()},h(){x(t,"class","slot svelte-411q9w"),x(t,"data-pos-x",e=r[15].initial.x),x(t,"data-pos-y",s=r[15].initial.y)},m(c,a){T(c,t,a),n()},p(c,a){r=c,a&8&&e!==(e=r[15].initial.x)&&x(t,"data-pos-x",e),a&8&&s!==(s=r[15].initial.y)&&x(t,"data-pos-y",s),i!==r[19]&&(l(),i=r[19],n())},d(c){c&&w(t),l()}}}function et(r){let t,e,s,i;return{c(){t=k("div"),this.h()},l(n){t=S(n,"DIV",{class:!0,style:!0}),O(t).forEach(w),this.h()},h(){x(t,"class","tile svelte-411q9w"),x(t,"style",e=r[15].style()),v(t,"drag-from",r[15].isDragFrom()),v(t,"top-ok",r[15].isOkWithNext(G)),v(t,"bottom-ok",r[15].isOkWithNext(R)),v(t,"left-ok",r[15].isOkWithNext(L)),v(t,"right-ok",r[15].isOkWithNext(W))},m(n,l){T(n,t,l),s||(i=I(t,"mousedown",r[4]),s=!0)},p(n,l){l&8&&e!==(e=n[15].style())&&x(t,"style",e),l&8&&v(t,"drag-from",n[15].isDragFrom()),l&8&&v(t,"top-ok",n[15].isOkWithNext(G)),l&8&&v(t,"bottom-ok",n[15].isOkWithNext(R)),l&8&&v(t,"left-ok",n[15].isOkWithNext(L)),l&8&&v(t,"right-ok",n[15].isOkWithNext(W))},d(n){n&&w(t),s=!1,i()}}}function Ct(r){let t,e,s,i,n,l,c=[...r[3].tiles()],a=[];for(let h=0;h<c.length;h+=1)a[h]=tt(j(r,c,h));let u=[...r[3].tiles()],f=[];for(let h=0;h<u.length;h+=1)f[h]=et(Z(r,u,h));return{c(){t=k("div"),e=k("div");for(let h=0;h<a.length;h+=1)a[h].c();i=C();for(let h=0;h<f.length;h+=1)f[h].c();this.h()},l(h){t=S(h,"DIV",{class:!0});var d=O(t);e=S(d,"DIV",{class:!0,style:!0});var o=O(e);for(let _=0;_<a.length;_+=1)a[_].l(o);o.forEach(w),i=P(d);for(let _=0;_<f.length;_+=1)f[_].l(d);d.forEach(w),this.h()},h(){x(e,"class","grid svelte-411q9w"),x(e,"style",s=r[3].style()),x(t,"class","stack svelte-411q9w"),v(t,"show-borders",r[0])},m(h,d){T(h,t,d),b(t,e);for(let o=0;o<a.length;o+=1)a[o]&&a[o].m(e,null);r[10](e),b(t,i);for(let o=0;o<f.length;o+=1)f[o]&&f[o].m(t,null);n||(l=[I(Q,"mouseup",r[6]),I(Q,"mousemove",r[5])],n=!0)},p(h,[d]){if(d&10){c=[...h[3].tiles()];let o;for(o=0;o<c.length;o+=1){const _=j(h,c,o);a[o]?a[o].p(_,d):(a[o]=tt(_),a[o].c(),a[o].m(e,null))}for(;o<a.length;o+=1)a[o].d(1);a.length=c.length}if(d&8&&s!==(s=h[3].style())&&x(e,"style",s),d&24){u=[...h[3].tiles()];let o;for(o=0;o<u.length;o+=1){const _=Z(h,u,o);f[o]?f[o].p(_,d):(f[o]=et(_),f[o].c(),f[o].m(t,null))}for(;o<f.length;o+=1)f[o].d(1);f.length=u.length}d&1&&v(t,"show-borders",h[0])},i:Y,o:Y,d(h){h&&w(t),H(a,h),r[10](null),H(f,h),n=!1,ot(l)}}}function Pt(r){if(r.dataset.posX&&r.dataset.posY){const t=Number(r.dataset.posX),e=Number(r.dataset.posY);return{x:t,y:e}}else return null}function Et(r){for(const t of document.elementsFromPoint(r.x,r.y))if(t instanceof HTMLElement){const e=Pt(t);if(e)return e}return null}function It(r,t,e){const s=[];let i;const n=$(()=>i?{x:i.offsetWidth,y:i.offsetHeight}:null),l=$((g,p)=>{if(s.length>0){if(g.x>=p)return null;const y=g.y*p+g.x;if(y>=0&&y<s.length)return{x:s[y].offsetLeft,y:s[y].offsetTop}}return null}),c=$((g,p)=>{if(s.length>0){const y=l.call(g,p),V=l.call(M(g,W),p),X=l.call(M(g,R),p),B=g.y*p+g.x;if(B<0||B>=s.length)return null;const q={x:s[B].offsetWidth,y:s[B].offsetHeight};return y&&V&&(q.x=V.x-y.x),y&&X&&(q.y=X.y-y.y),q}return null});function a(g){const p={x:g.clientX,y:g.clientY},y=Et(p);y&&(o.setDragFrom(y,p),e(3,o))}function u(g){const p={x:g.clientX,y:g.clientY};o.dragUpdate(p),e(3,o)}function f(g){o.unsetDragFrom(),e(3,o)}let{tileCount:h=100}=t,{showBorders:d=!1}=t,o=new Tt({tileCount:h,image:{url:wt,size:{x:930,y:1162}},getGridSize:n.call,getSlotPos:l.call,getSlotSize:c.call});o.shuffle();function _(){o.shuffle(),e(3,o)}function z(){n.clear(),l.clear(),c.clear(),e(3,o)}dt(()=>(e(3,o),window.addEventListener("resize",z),()=>{window.removeEventListener("resize",z)}));function m(g,p){A[g?"unshift":"push"](()=>{s[p]=g,e(1,s)})}function D(g){A[g?"unshift":"push"](()=>{i=g,e(2,i)})}return r.$$set=g=>{"tileCount"in g&&e(7,h=g.tileCount),"showBorders"in g&&e(0,d=g.showBorders)},[d,s,i,o,a,u,f,h,_,m,D]}class Mt extends rt{constructor(t){super(),st(this,t,It,Ct,it,{tileCount:7,showBorders:0,shuffle:8})}get shuffle(){return this.$$.ctx[8]}}function zt(r){let t,e,s,i,n,l,c,a,u,f,h,d,o,_,z={showBorders:r[1],tileCount:r[2]};return t=new Mt({props:z}),r[3](t),{c(){nt(t.$$.fragment),e=C(),s=k("div"),i=k("button"),n=J("Shuffle"),l=C(),c=k("div"),a=k("input"),u=C(),f=k("label"),h=J("Show borders"),this.h()},l(m){lt(t.$$.fragment,m),e=P(m),s=S(m,"DIV",{class:!0});var D=O(s);i=S(D,"BUTTON",{});var g=O(i);n=K(g,"Shuffle"),g.forEach(w),l=P(D),c=S(D,"DIV",{});var p=O(c);a=S(p,"INPUT",{id:!0,type:!0}),u=P(p),f=S(p,"LABEL",{for:!0});var y=O(f);h=K(y,"Show borders"),y.forEach(w),p.forEach(w),D.forEach(w),this.h()},h(){x(a,"id","boder-checkbox"),x(a,"type","checkbox"),x(f,"for","boder-checkbox"),x(s,"class","toolbar svelte-10goblz")},m(m,D){at(t,m,D),T(m,e,D),T(m,s,D),b(s,i),b(i,n),b(s,l),b(s,c),b(c,a),a.checked=r[1],b(c,u),b(c,f),b(f,h),d=!0,o||(_=[I(i,"click",r[4]),I(a,"change",r[5])],o=!0)},p(m,D){const g={};D&2&&(g.showBorders=m[1]),t.$set(g),D&2&&(a.checked=m[1])},i(m){d||(ut(t.$$.fragment,m),d=!0)},o(m){ht(t.$$.fragment,m),d=!1},d(m){r[3](null),ft(t,m),m&&w(e),m&&w(s),o=!1,ot(_)}}}function Bt(r){let t,e,s;return e=new yt({props:{$$slots:{default:[zt]},$$scope:{ctx:r}}}),{c(){t=C(),nt(e.$$.fragment),this.h()},l(i){pt("svelte-o5nfkw",document.head).forEach(w),t=P(i),lt(e.$$.fragment,i),this.h()},h(){document.title="Play - Picture slicer multi"},m(i,n){T(i,t,n),at(e,i,n),s=!0},p(i,[n]){const l={};n&131&&(l.$$scope={dirty:n,ctx:i}),e.$set(l)},i(i){s||(ut(e.$$.fragment,i),s=!0)},o(i){ht(e.$$.fragment,i),s=!1},d(i){i&&w(t),ft(e,i)}}}function Nt(r,t,e){let s;_t(r,xt,f=>e(6,s=f));const i=parseInt(s.url.searchParams.get("n")??"100");let n,l;function c(f){A[f?"unshift":"push"](()=>{n=f,e(0,n)})}const a=()=>n.shuffle();function u(){l=this.checked,e(1,l)}return[n,l,i,c,a,u]}class At extends rt{constructor(t){super(),st(this,t,Nt,Bt,it,{})}}export{At as component};
