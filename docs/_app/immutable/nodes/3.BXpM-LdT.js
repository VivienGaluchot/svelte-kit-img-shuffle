var St=Object.defineProperty;var Ft=(s,t,e)=>t in s?St(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var C=(s,t,e)=>Ft(s,typeof t!="symbol"?t+"":t,e);import{s as mt,n as rt,r as bt,o as Ct,e as z,c as Tt,x as X}from"../chunks/scheduler.CcFN-_cZ.js";import{S as _t,i as pt,e as P,s as q,c as M,a as B,d as D,f as A,v as k,B as b,g as I,h as T,C as et,k as wt,l as Ot,m as yt,n as vt,o as xt,p as Dt,q as kt,D as Y,t as N,b as W,j as $,x as Pt}from"../chunks/index.Csv5Vs4x.js";import{b as Mt}from"../chunks/paths.m39TCpgX.js";import{p as It}from"../chunks/stores.7N_aFOuU.js";import{s as Et,e as U,u as ot,d as nt,S as zt,i as Bt}from"../chunks/image.D0jFKXzh.js";const Nt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function V(s,t){return L(s,t,(e,i)=>e+i)}function G(s,t){return L(s,t,(e,i)=>e-i)}function Wt(s,t){let e=s;return t.min&&(e=L(e,t.min,Math.max)),t.max&&(e=L(e,t.max,Math.min)),e}function Rt(s,t){return L(s,t,(e,i)=>e/i)}function qt(s){return At(s,Math.round)}function R(s,t){return s.x==t.x&&s.y==t.y}function At(s,t){return{x:t(s.x),y:t(s.y)}}function L(s,t,e){return{x:e(s.x,t.x),y:e(s.y,t.y)}}function tt(s){const t=new Map;return{call:(...e)=>{const i=JSON.stringify(e),r=t.get(i);if(r)return r;{const a=s(...e);return t.set(i,a),a}},clear:()=>{t.clear()}}}function Gt(s){let t=s.length,e;for(;t!=0;)e=Math.floor(Math.random()*t),t--,[s[t],s[e]]=[s[e],s[t]]}class Vt{constructor(t,e,i){C(this,"matrix");C(this,"initial");C(this,"current");C(this,"drag");this.matrix=i,this.initial={x:t,y:e},this.current={x:t,y:e},this.drag={from:null,to:null}}get rows(){return this.matrix.rows}get cols(){return this.matrix.cols}get image(){return this.matrix.image}isDragFrom(){return this.drag.from!=null}isDragTo(){return this.drag.to!=null}originOrCurrent(){var t,e;return((t=this.drag.from)==null?void 0:t.originCurrent)??((e=this.drag.to)==null?void 0:e.originCurrent)??this.current}getNext(t){return this.matrix.tileByCurrent(V(this.current,t))}isAtInitial(){return R(this.current,this.initial)}isOkWith(t){return R(G(t.current,this.current),G(t.initial,this.initial))}isOkWithNext(t){const e=this.getNext(t);return e?e.isOkWith(this):!0}setDragFrom(t){if(this.drag.from!=null)throw new Error("setDragFrom: from already set");if(this.drag.to!=null)throw new Error("setDragFrom: to already set");if(!this.matrix.options.getSlotPos(this.current,this.cols))throw new Error("setDragFrom: slot not found");this.drag.from={originCurrent:this.current,originMouse:t,pullOffset:{x:0,y:0}}}updateDragFrom(t){if(this.drag.from==null)throw new Error("updateDragFrom: from unset");const e=G(t,this.drag.from.originMouse);this.drag.from.pullOffset=e}unsetDragFrom(){if(this.drag.from==null)throw new Error("unsetDragFrom: from unset");this.drag.from=null}setDragTo(){if(this.drag.from!=null)throw new Error("setDragTo: from already set");if(this.drag.to!=null)throw new Error("setDragTo: to already set");this.drag.to={originCurrent:this.current}}unsetDragTo(){if(this.drag.to==null)throw new Error("unsetDragTo: to unset");this.current=this.drag.to.originCurrent,this.drag.to=null}style(){var u,o,g;const t=this.matrix.options.getGridSize(),e=this.matrix.options.getSlotPos(this.initial,this.cols);let i;this.isDragFrom()?i=this.originOrCurrent():i=this.current;const r=this.matrix.options.getSlotPos(i,this.cols),a=this.matrix.options.getSlotSize(i,this.cols);if(t&&e&&r&&a){let n={...e};n.x=Math.min(n.x,t.x-a.x),n.x=Math.max(n.x,0),n.x=n.x*-1,n.y=Math.min(n.y,t.y-a.y),n.y=Math.max(n.y,0),n.y=n.y*-1;const p=t;return`left: ${r.x+(((u=this.drag.from)==null?void 0:u.pullOffset.x)??0)}px; top: ${r.y+(((g=(o=this.drag.from)==null?void 0:o.pullOffset)==null?void 0:g.y)??0)}px; width: ${a.x}px; height: ${a.y}px;background-image: url(${this.image.url}); background-position: ${n.x}px ${n.y}px; background-size: ${p.x}px ${p.y}px ; `}}}const st={x:0,y:-1},j={x:0,y:1},it={x:-1,y:0},J={x:1,y:0},Lt=[st,j,it,J];class Ht{constructor(t){C(this,"options");C(this,"rows");C(this,"cols");C(this,"matrix",[]);C(this,"dragFrom",null);C(this,"dragTarget",null);this.options=t;let e=Et(t.image.size,t.tileCount);this.cols=e.x,this.rows=e.y,this.matrix=[];for(let i=0;i<this.rows;i++)for(let r=0;r<this.cols;r++)this.matrix.push(new Vt(r,i,this))}get image(){return this.options.image}*tiles(){for(const t of this.matrix)yield t}tileGroup(t){const e=new Set;function i(r){if(!e.has(r)){e.add(r);for(const a of Lt){const u=r.getNext(a);u&&r.isOkWith(u)&&i(u)}}}return i(t),e}tileByInitial(t){return this.isInRange(t)?this.matrix[t.y*this.cols+t.x]:null}isInRange(t){return t.x>=0&&t.x<this.cols&&t.y>=0&&t.y<this.rows}tileByCurrent(t){for(const e of this.matrix)if(R(e.current,t))return e;return null}tileByOriginCurrent(t){for(const e of this.matrix)if(R(e.originOrCurrent(),t))return e;return null}style(){return`aspect-ratio: ${this.image.size.x} / ${this.image.size.y}; grid-template-columns: repeat(${this.cols}, 1fr);`}shuffle(){const t=[...this.matrix.map(e=>({...e.current}))];Gt(t);for(const e in this.matrix)this.matrix[e].current=t[e]}solveDrag(t,e){const i=[];if(e.x!=0||e.y!=0){const r=[];for(const a of t){const u=V(a.current,e);if(!this.isInRange(u))return[];r.push({pos:u,tile:a})}for(const{pos:a,tile:u}of r){i.push({tile:u,pos:a,isDragTo:!1});const o=this.tileByOriginCurrent(a);if(o&&!t.includes(o)){let g,n,p=u,w=0;do{g=p.originOrCurrent(),n=!0;for(const{pos:S,tile:v}of r)if(R(S,g)){n=!1,p=v;break}if(w++,w>1e3)throw new Error("infinite loop")}while(!n);i.push({tile:o,pos:g,isDragTo:!0})}}}return i}isSolved(){for(const t of this.matrix)if(!t.isAtInitial())return!1;return!0}setDragFrom(t,e){const i=this.tileByOriginCurrent(t);if(i){const r=[...this.tileGroup(i)];this.dragFrom={startClient:e,startPos:t,currentPos:t,tiles:r,dragActions:[]},r.map(a=>a.setDragFrom(e))}}dragUpdate(t){var i;const e=this.options.getSlotSize(this.matrix[0].current,this.cols);if(e&&this.dragFrom){const r=G(t,this.dragFrom.startClient),a=qt(Rt(r,e)),u=Wt(V(this.dragFrom.startPos,a),{min:{x:0,y:0},max:{x:this.cols-1,y:this.rows-1}}),o=G(u,this.dragFrom.currentPos);this.dragFrom.currentPos=u;const g=this.solveDrag(this.dragFrom.tiles,o);g.length!=0&&(this.dragFrom.dragActions.map(n=>{n.isDragTo&&n.tile.unsetDragTo()}),this.dragFrom.dragActions=g,this.dragFrom.dragActions.map(n=>{n.isDragTo?n.tile.setDragTo():n.tile.updateDragFrom(t),n.tile.current=n.pos})),(i=this.dragFrom)==null||i.tiles.map(n=>{n.updateDragFrom(t)})}}unsetDragFrom(t){var i,r,a,u;let e;return t&&((i=this.dragFrom)!=null&&i.startPos)&&!R((r=this.dragFrom)==null?void 0:r.startPos,t)?e=!0:e=!1,(a=this.dragFrom)==null||a.tiles.map(o=>o.unsetDragFrom()),(u=this.dragFrom)==null||u.dragActions.map(o=>{o.isDragTo&&o.tile.unsetDragTo(),o.tile.current=o.pos}),this.dragFrom=null,this.dragTarget=null,e}}const{window:lt}=Nt;function at(s,t,e){const i=s.slice();return i[20]=t[e],i}function ut(s,t,e){const i=s.slice();return i[20]=t[e],i[23]=t,i[24]=e,i}function ft(s,t){let e,i,r,a=t[24];const u=()=>t[14](e,a),o=()=>t[14](null,a);return{key:s,first:null,c(){e=P("div"),this.h()},l(g){e=M(g,"DIV",{class:!0,"data-pos-x":!0,"data-pos-y":!0}),B(e).forEach(D),this.h()},h(){k(e,"class","slot svelte-411q9w"),k(e,"data-pos-x",i=t[20].initial.x),k(e,"data-pos-y",r=t[20].initial.y),this.first=e},m(g,n){I(g,e,n),u()},p(g,n){t=g,n&8&&i!==(i=t[20].initial.x)&&k(e,"data-pos-x",i),n&8&&r!==(r=t[20].initial.y)&&k(e,"data-pos-y",r),a!==t[24]&&(o(),a=t[24],u())},d(g){g&&D(e),o()}}}function ct(s,t){let e,i,r,a;return{key:s,first:null,c(){e=P("div"),this.h()},l(u){e=M(u,"DIV",{class:!0,style:!0}),B(e).forEach(D),this.h()},h(){k(e,"class","tile svelte-411q9w"),k(e,"style",i=t[20].style()),b(e,"drag-from",t[20].isDragFrom()),b(e,"top-ok",t[20].isOkWithNext(st)),b(e,"bottom-ok",t[20].isOkWithNext(j)),b(e,"left-ok",t[20].isOkWithNext(it)),b(e,"right-ok",t[20].isOkWithNext(J)),this.first=e},m(u,o){I(u,e,o),r||(a=et(e,"mousedown",t[4]),r=!0)},p(u,o){t=u,o&8&&i!==(i=t[20].style())&&k(e,"style",i),o&8&&b(e,"drag-from",t[20].isDragFrom()),o&8&&b(e,"top-ok",t[20].isOkWithNext(st)),o&8&&b(e,"bottom-ok",t[20].isOkWithNext(j)),o&8&&b(e,"left-ok",t[20].isOkWithNext(it)),o&8&&b(e,"right-ok",t[20].isOkWithNext(J))},d(u){u&&D(e),r=!1,a()}}}function Xt(s){let t,e,i=[],r=new Map,a,u,o=[],g=new Map,n,p,w=U([...s[3].tiles()]);const S=c=>c[20];for(let c=0;c<w.length;c+=1){let d=ut(s,w,c),_=S(d);r.set(_,i[c]=ft(_,d))}let v=U([...s[3].tiles()]);const x=c=>c[20];for(let c=0;c<v.length;c+=1){let d=at(s,v,c),_=x(d);g.set(_,o[c]=ct(_,d))}return{c(){t=P("div"),e=P("div");for(let c=0;c<i.length;c+=1)i[c].c();u=q();for(let c=0;c<o.length;c+=1)o[c].c();this.h()},l(c){t=M(c,"DIV",{class:!0});var d=B(t);e=M(d,"DIV",{class:!0,style:!0});var _=B(e);for(let h=0;h<i.length;h+=1)i[h].l(_);_.forEach(D),u=A(d);for(let h=0;h<o.length;h+=1)o[h].l(d);d.forEach(D),this.h()},h(){k(e,"class","grid svelte-411q9w"),k(e,"style",a=s[3].style()),k(t,"class","stack svelte-411q9w"),b(t,"show-borders",s[0])},m(c,d){I(c,t,d),T(t,e);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(e,null);s[15](e),T(t,u);for(let _=0;_<o.length;_+=1)o[_]&&o[_].m(t,null);n||(p=[et(lt,"mouseup",s[6]),et(lt,"mousemove",s[5])],n=!0)},p(c,[d]){d&10&&(w=U([...c[3].tiles()]),i=ot(i,d,S,1,c,w,r,e,nt,ft,null,ut)),d&8&&a!==(a=c[3].style())&&k(e,"style",a),d&24&&(v=U([...c[3].tiles()]),o=ot(o,d,x,1,c,v,g,t,nt,ct,null,at)),d&1&&b(t,"show-borders",c[0])},i:rt,o:rt,d(c){c&&D(t);for(let d=0;d<i.length;d+=1)i[d].d();s[15](null);for(let d=0;d<o.length;d+=1)o[d].d();n=!1,bt(p)}}}function Yt(s){if(s.dataset.posX&&s.dataset.posY){const t=Number(s.dataset.posX),e=Number(s.dataset.posY);return{x:t,y:e}}else return null}function ht(s){for(const t of document.elementsFromPoint(s.x,s.y))if(t instanceof HTMLElement){const e=Yt(t);if(e)return e}return null}function Ut(s,t,e){let{tileCount:i}=t,{image:r}=t,{showBorders:a}=t,{actionCount:u=0}=t,{rows:o=0}=t,{cols:g=0}=t,{isSolved:n=!1}=t;const p=[];let w;const S=tt(()=>w?{x:w.offsetWidth,y:w.offsetHeight}:null),v=tt((l,m)=>{if(p.length>0){if(l.x>=m)return null;const f=l.y*m+l.x;if(f>=0&&f<p.length)return{x:p[f].offsetLeft,y:p[f].offsetTop}}return null}),x=tt((l,m)=>{if(p.length>0){const f=v.call(l,m),y=v.call(V(l,J),m),F=v.call(V(l,j),m),O=l.y*m+l.x;if(O<0||O>=p.length)return null;const Q={x:p[O].offsetWidth,y:p[O].offsetHeight};return f&&y&&(Q.x=y.x-f.x),f&&F&&(Q.y=F.y-f.y),Q}return null});function c(l){if(n)return;const m={x:l.clientX,y:l.clientY},f=ht(m);f&&(h.setDragFrom(f,m),e(3,h))}function d(l){if(n)return;const m={x:l.clientX,y:l.clientY};h.dragUpdate(m),e(3,h)}function _(l){if(n)return;const m={x:l.clientX,y:l.clientY},f=ht(m);h.unsetDragFrom(f)&&e(7,u+=1),e(3,h),e(10,n=h.isSolved())}let h=new Ht({tileCount:i,image:r,getGridSize:S.call,getSlotPos:v.call,getSlotSize:x.call});h.shuffle();function Z(){h.shuffle(),e(3,h),e(10,n=h.isSolved())}function H(){S.clear(),v.clear(),x.clear(),e(3,h)}Ct(()=>(e(3,h),e(10,n=h.isSolved()),e(8,o=h.rows),e(9,g=h.cols),window.addEventListener("resize",H),()=>{window.removeEventListener("resize",H)}));function K(l,m){z[l?"unshift":"push"](()=>{p[m]=l,e(1,p)})}function E(l){z[l?"unshift":"push"](()=>{w=l,e(2,w)})}return s.$$set=l=>{"tileCount"in l&&e(11,i=l.tileCount),"image"in l&&e(12,r=l.image),"showBorders"in l&&e(0,a=l.showBorders),"actionCount"in l&&e(7,u=l.actionCount),"rows"in l&&e(8,o=l.rows),"cols"in l&&e(9,g=l.cols),"isSolved"in l&&e(10,n=l.isSolved)},[a,p,w,h,c,d,_,u,o,g,n,i,r,Z,K,E]}class jt extends _t{constructor(t){super(),pt(this,t,Ut,Xt,mt,{tileCount:11,image:12,showBorders:0,actionCount:7,rows:8,cols:9,isSolved:10,shuffle:13})}get shuffle(){return this.$$.ctx[13]}}function gt(s){let t,e=`Solved ✨ <a href="${Mt}">Play again</a>`;return{c(){t=P("div"),t.innerHTML=e},l(i){t=M(i,"DIV",{"data-svelte-h":!0}),Pt(t)!=="svelte-cmma27"&&(t.innerHTML=e)},m(i,r){I(i,t,r)},d(i){i&&D(t)}}}function dt(s){let t;return{c(){t=N("s")},l(e){t=W(e,"s")},m(e,i){I(e,t,i)},d(e){e&&D(t)}}}function Jt(s){let t,e,i,r,a,u,o,g,n,p,w,S,v,x,c,d,_;function h(f){s[9](f)}function Z(f){s[10](f)}function H(f){s[11](f)}function K(f){s[12](f)}let E={showBorders:s[7],tileCount:s[5],image:s[6]};s[1]!==void 0&&(E.rows=s[1]),s[2]!==void 0&&(E.cols=s[2]),s[0]!==void 0&&(E.actionCount=s[0]),s[3]!==void 0&&(E.isSolved=s[3]),t=new jt({props:E}),s[8](t),z.push(()=>Y(t,"rows",h)),z.push(()=>Y(t,"cols",Z)),z.push(()=>Y(t,"actionCount",H)),z.push(()=>Y(t,"isSolved",K));let l=s[3]&&gt(),m=s[0]>1&&dt();return{c(){wt(t.$$.fragment),u=q(),o=P("div"),g=P("div"),n=N(s[1]),p=N(" x "),w=N(s[2]),S=q(),l&&l.c(),v=q(),x=P("div"),c=N(s[0]),d=N(" move"),m&&m.c(),this.h()},l(f){yt(t.$$.fragment,f),u=A(f),o=M(f,"DIV",{class:!0});var y=B(o);g=M(y,"DIV",{class:!0});var F=B(g);n=W(F,s[1]),p=W(F," x "),w=W(F,s[2]),F.forEach(D),S=A(y),l&&l.l(y),v=A(y),x=M(y,"DIV",{class:!0});var O=B(x);c=W(O,s[0]),d=W(O," move"),m&&m.l(O),O.forEach(D),y.forEach(D),this.h()},h(){k(g,"class","muted svelte-cx25hv"),k(x,"class","muted svelte-cx25hv"),k(o,"class","toolbar svelte-cx25hv")},m(f,y){vt(t,f,y),I(f,u,y),I(f,o,y),T(o,g),T(g,n),T(g,p),T(g,w),T(o,S),l&&l.m(o,null),T(o,v),T(o,x),T(x,c),T(x,d),m&&m.m(x,null),_=!0},p(f,y){const F={};!e&&y&2&&(e=!0,F.rows=f[1],X(()=>e=!1)),!i&&y&4&&(i=!0,F.cols=f[2],X(()=>i=!1)),!r&&y&1&&(r=!0,F.actionCount=f[0],X(()=>r=!1)),!a&&y&8&&(a=!0,F.isSolved=f[3],X(()=>a=!1)),t.$set(F),(!_||y&2)&&$(n,f[1]),(!_||y&4)&&$(w,f[2]),f[3]?l||(l=gt(),l.c(),l.m(o,v)):l&&(l.d(1),l=null),(!_||y&1)&&$(c,f[0]),f[0]>1?m||(m=dt(),m.c(),m.m(x,null)):m&&(m.d(1),m=null)},i(f){_||(xt(t.$$.fragment,f),_=!0)},o(f){Dt(t.$$.fragment,f),_=!1},d(f){f&&(D(u),D(o)),s[8](null),kt(t,f),l&&l.d(),m&&m.d()}}}function Zt(s){let t,e,i;return e=new zt({props:{$$slots:{default:[Jt]},$$scope:{ctx:s}}}),{c(){t=q(),wt(e.$$.fragment),this.h()},l(r){Ot("svelte-66crdv",document.head).forEach(D),t=A(r),yt(e.$$.fragment,r),this.h()},h(){document.title="Play - Picture slicer"},m(r,a){I(r,t,a),vt(e,r,a),i=!0},p(r,[a]){const u={};a&32799&&(u.$$scope={dirty:a,ctx:r}),e.$set(u)},i(r){i||(xt(e.$$.fragment,r),i=!0)},o(r){Dt(e.$$.fragment,r),i=!1},d(r){r&&D(t),kt(e,r)}}}function Kt(s,t,e){let i;Tt(s,It,h=>e(13,i=h));const r=parseInt(i.url.searchParams.get("n")??"100"),a=parseInt(i.url.searchParams.get("i")??"0"),u=Bt[a];let o,g,n,p,w,S;function v(h){z[h?"unshift":"push"](()=>{w=h,e(4,w)})}function x(h){g=h,e(1,g)}function c(h){n=h,e(2,n)}function d(h){o=h,e(0,o)}function _(h){p=h,e(3,p)}return[o,g,n,p,w,r,u,S,v,x,c,d,_]}class re extends _t{constructor(t){super(),pt(this,t,Kt,Zt,mt,{})}}export{re as component};
