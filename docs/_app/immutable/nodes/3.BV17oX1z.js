var gt=Object.defineProperty;var mt=(r,t,e)=>t in r?gt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var F=(r,t,e)=>mt(r,typeof t!="symbol"?t+"":t,e);import{s as st,n as $,r as it,o as dt,f as U,c as pt}from"../chunks/scheduler.BjFDxd0B.js";import{S as ot,i as nt,e as b,s as P,c as C,a as T,d as w,f as E,u as _,F as v,g as O,h as S,x as z,y as j,k as lt,l as _t,m as at,n as ut,o as ht,p as ft,q as ct,r as J}from"../chunks/index.9xirAVBY.js";import{p as xt}from"../chunks/stores.BDtpNb7y.js";import{s as yt,e as W,S as wt,i as Dt}from"../chunks/image.oZfzRE0v.js";const vt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function M(r,t){return B(r,t,(e,s)=>e+s)}function I(r,t){return B(r,t,(e,s)=>e-s)}function Ft(r,t){let e=r;return t.min&&(e=B(e,t.min,Math.max)),t.max&&(e=B(e,t.max,Math.min)),e}function kt(r,t){return B(r,t,(e,s)=>e/s)}function bt(r){return Ct(r,Math.round)}function R(r,t){return r.x==t.x&&r.y==t.y}function Ct(r,t){return{x:t(r.x),y:t(r.y)}}function B(r,t,e){return{x:e(r.x,t.x),y:e(r.y,t.y)}}function V(r){const t=new Map;return{call:(...e)=>{const s=t.get(e);if(s)return s;{const i=r(...e);return t.set(e,i),i}},clear:()=>{t.clear()}}}function St(r){let t=r.length,e;for(;t!=0;)e=Math.floor(Math.random()*t),t--,[r[t],r[e]]=[r[e],r[t]]}class Tt{constructor(t,e,s){F(this,"matrix");F(this,"initial");F(this,"current");F(this,"drag");this.matrix=s,this.initial={x:t,y:e},this.current={x:t,y:e},this.drag={from:null,to:null}}get rows(){return this.matrix.rows}get cols(){return this.matrix.cols}get image(){return this.matrix.image}isDragFrom(){return this.drag.from!=null}isDragTo(){return this.drag.to!=null}originOrCurrent(){var t,e;return((t=this.drag.from)==null?void 0:t.originCurrent)??((e=this.drag.to)==null?void 0:e.originCurrent)??this.current}getNext(t){return this.matrix.tileByCurrent(M(this.current,t))}isOkWith(t){return R(I(t.current,this.current),I(t.initial,this.initial))}isOkWithNext(t){const e=this.getNext(t);return e?e.isOkWith(this):!0}setDragFrom(t){if(this.drag.from!=null)throw new Error("setDragFrom: from already set");if(this.drag.to!=null)throw new Error("setDragFrom: to already set");if(!this.matrix.options.getSlotPos(this.current,this.cols))throw new Error("setDragFrom: slot not found");this.drag.from={originCurrent:this.current,originMouse:t,pullOffset:{x:0,y:0}}}updateDragFrom(t){if(this.drag.from==null)throw new Error("updateDragFrom: from unset");const e=I(t,this.drag.from.originMouse);this.drag.from.pullOffset=e}unsetDragFrom(){if(this.drag.from==null)throw new Error("unsetDragFrom: from unset");this.drag.from=null}setDragTo(){if(this.drag.from!=null)throw new Error("setDragTo: from already set");if(this.drag.to!=null)throw new Error("setDragTo: to already set");this.drag.to={originCurrent:this.current}}unsetDragTo(){if(this.drag.to==null)throw new Error("unsetDragTo: to unset");this.current=this.drag.to.originCurrent,this.drag.to=null}style(){var a,f,n;const t=this.matrix.options.getGridSize(),e=this.matrix.options.getSlotPos(this.initial,this.cols);let s;this.isDragFrom()?s=this.originOrCurrent():s=this.current;const i=this.matrix.options.getSlotPos(s,this.cols),o=this.matrix.options.getSlotSize(s,this.cols);if(t&&e&&i&&o){let u={...e};u.x=Math.min(u.x,t.x-o.x),u.x=Math.max(u.x,0),u.x=u.x*-1,u.y=Math.min(u.y,t.y-o.y),u.y=Math.max(u.y,0),u.y=u.y*-1;const c=t;return`left: ${i.x+(((a=this.drag.from)==null?void 0:a.pullOffset.x)??0)}px; top: ${i.y+(((n=(f=this.drag.from)==null?void 0:f.pullOffset)==null?void 0:n.y)??0)}px; width: ${o.x}px; height: ${o.y}px;background-image: url(${this.image.url}); background-position: ${u.x}px ${u.y}px; background-size: ${c.x}px ${c.y}px ; `}}}const H={x:0,y:-1},q={x:0,y:1},X={x:-1,y:0},G={x:1,y:0},Ot=[H,q,X,G];class Pt{constructor(t){F(this,"options");F(this,"rows");F(this,"cols");F(this,"matrix",[]);F(this,"dragFrom",null);F(this,"dragTarget",null);this.options=t;let e=yt(t.image.size,t.tileCount);this.cols=e.x,this.rows=e.y,this.matrix=[];for(let s=0;s<this.rows;s++)for(let i=0;i<this.cols;i++)this.matrix.push(new Tt(i,s,this))}get image(){return this.options.image}*tiles(){for(const t of this.matrix)yield t}tileGroup(t){const e=new Set;function s(i){if(!e.has(i)){e.add(i);for(const o of Ot){const a=i.getNext(o);a&&i.isOkWith(a)&&s(a)}}}return s(t),e}tileByInitial(t){return this.isInRange(t)?this.matrix[t.y*this.cols+t.x]:null}isInRange(t){return t.x>=0&&t.x<this.cols&&t.y>=0&&t.y<this.rows}tileByCurrent(t){for(const e of this.matrix)if(R(e.current,t))return e;return null}tileByOriginCurrent(t){for(const e of this.matrix)if(R(e.originOrCurrent(),t))return e;return null}style(){return`aspect-ratio: ${this.image.size.x} / ${this.image.size.y}; grid-template-columns: repeat(${this.cols}, 1fr);`}shuffle(){const t=[...this.matrix.map(e=>({...e.current}))];St(t);for(const e in this.matrix)this.matrix[e].current=t[e]}solveDrag(t,e){const s=[];if(e.x!=0||e.y!=0){const i=[];for(const o of t){const a=M(o.current,e);if(!this.isInRange(a))return[];i.push({pos:a,tile:o})}for(const{pos:o,tile:a}of i){s.push({tile:a,pos:o,isDragTo:!1});const f=this.tileByOriginCurrent(o);if(f&&!t.includes(f)){let n,u,c=a,h=0;do{n=c.originOrCurrent(),u=!0;for(const{pos:g,tile:l}of i)if(R(g,n)){u=!1,c=l;break}if(h++,h>1e3)throw new Error("infinite loop")}while(!u);s.push({tile:f,pos:n,isDragTo:!0})}}}return s}setDragFrom(t,e){const s=this.tileByOriginCurrent(t);if(s){const i=[...this.tileGroup(s)];this.dragFrom={startClient:e,startPos:t,currentPos:t,tiles:i,dragActions:[]},i.map(o=>o.setDragFrom(e))}}dragUpdate(t){var s;const e=this.options.getSlotSize(this.matrix[0].current,this.cols);if(e&&this.dragFrom){const i=I(t,this.dragFrom.startClient),o=bt(kt(i,e)),a=Ft(M(this.dragFrom.startPos,o),{min:{x:0,y:0},max:{x:this.cols-1,y:this.rows-1}}),f=I(a,this.dragFrom.currentPos);this.dragFrom.currentPos=a;const n=this.solveDrag(this.dragFrom.tiles,f);n.length!=0&&(this.dragFrom.dragActions.map(u=>{u.isDragTo&&u.tile.unsetDragTo()}),this.dragFrom.dragActions=n,this.dragFrom.dragActions.map(u=>{u.isDragTo?u.tile.setDragTo():u.tile.updateDragFrom(t),u.tile.current=u.pos})),(s=this.dragFrom)==null||s.tiles.map(u=>{u.updateDragFrom(t)})}}unsetDragFrom(){var t,e;(t=this.dragFrom)==null||t.tiles.map(s=>s.unsetDragFrom()),(e=this.dragFrom)==null||e.dragActions.map(s=>{s.isDragTo&&s.tile.unsetDragTo(),s.tile.current=s.pos}),this.dragFrom=null,this.dragTarget=null}}const{window:K}=vt;function Q(r,t,e){const s=r.slice();return s[16]=t[e],s}function tt(r,t,e){const s=r.slice();return s[16]=t[e],s[19]=t,s[20]=e,s}function et(r){let t,e,s,i=r[20];const o=()=>r[10](t,i),a=()=>r[10](null,i);return{c(){t=b("div"),this.h()},l(f){t=C(f,"DIV",{class:!0,"data-pos-x":!0,"data-pos-y":!0}),T(t).forEach(w),this.h()},h(){_(t,"class","slot svelte-411q9w"),_(t,"data-pos-x",e=r[16].initial.x),_(t,"data-pos-y",s=r[16].initial.y)},m(f,n){O(f,t,n),o()},p(f,n){r=f,n&8&&e!==(e=r[16].initial.x)&&_(t,"data-pos-x",e),n&8&&s!==(s=r[16].initial.y)&&_(t,"data-pos-y",s),i!==r[20]&&(a(),i=r[20],o())},d(f){f&&w(t),a()}}}function rt(r){let t,e,s,i;return{c(){t=b("div"),this.h()},l(o){t=C(o,"DIV",{class:!0,style:!0}),T(t).forEach(w),this.h()},h(){_(t,"class","tile svelte-411q9w"),_(t,"style",e=r[16].style()),v(t,"drag-from",r[16].isDragFrom()),v(t,"top-ok",r[16].isOkWithNext(H)),v(t,"bottom-ok",r[16].isOkWithNext(q)),v(t,"left-ok",r[16].isOkWithNext(X)),v(t,"right-ok",r[16].isOkWithNext(G))},m(o,a){O(o,t,a),s||(i=z(t,"mousedown",r[4]),s=!0)},p(o,a){a&8&&e!==(e=o[16].style())&&_(t,"style",e),a&8&&v(t,"drag-from",o[16].isDragFrom()),a&8&&v(t,"top-ok",o[16].isOkWithNext(H)),a&8&&v(t,"bottom-ok",o[16].isOkWithNext(q)),a&8&&v(t,"left-ok",o[16].isOkWithNext(X)),a&8&&v(t,"right-ok",o[16].isOkWithNext(G))},d(o){o&&w(t),s=!1,i()}}}function Et(r){let t,e,s,i,o,a,f=W([...r[3].tiles()]),n=[];for(let h=0;h<f.length;h+=1)n[h]=et(tt(r,f,h));let u=W([...r[3].tiles()]),c=[];for(let h=0;h<u.length;h+=1)c[h]=rt(Q(r,u,h));return{c(){t=b("div"),e=b("div");for(let h=0;h<n.length;h+=1)n[h].c();i=P();for(let h=0;h<c.length;h+=1)c[h].c();this.h()},l(h){t=C(h,"DIV",{class:!0});var g=T(t);e=C(g,"DIV",{class:!0,style:!0});var l=T(e);for(let m=0;m<n.length;m+=1)n[m].l(l);l.forEach(w),i=E(g);for(let m=0;m<c.length;m+=1)c[m].l(g);g.forEach(w),this.h()},h(){_(e,"class","grid svelte-411q9w"),_(e,"style",s=r[3].style()),_(t,"class","stack svelte-411q9w"),v(t,"show-borders",r[0])},m(h,g){O(h,t,g),S(t,e);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null);r[11](e),S(t,i);for(let l=0;l<c.length;l+=1)c[l]&&c[l].m(t,null);o||(a=[z(K,"mouseup",r[6]),z(K,"mousemove",r[5])],o=!0)},p(h,[g]){if(g&10){f=W([...h[3].tiles()]);let l;for(l=0;l<f.length;l+=1){const m=tt(h,f,l);n[l]?n[l].p(m,g):(n[l]=et(m),n[l].c(),n[l].m(e,null))}for(;l<n.length;l+=1)n[l].d(1);n.length=f.length}if(g&8&&s!==(s=h[3].style())&&_(e,"style",s),g&24){u=W([...h[3].tiles()]);let l;for(l=0;l<u.length;l+=1){const m=Q(h,u,l);c[l]?c[l].p(m,g):(c[l]=rt(m),c[l].c(),c[l].m(t,null))}for(;l<c.length;l+=1)c[l].d(1);c.length=u.length}g&1&&v(t,"show-borders",h[0])},i:$,o:$,d(h){h&&w(t),j(n,h),r[11](null),j(c,h),o=!1,it(a)}}}function It(r){if(r.dataset.posX&&r.dataset.posY){const t=Number(r.dataset.posX),e=Number(r.dataset.posY);return{x:t,y:e}}else return null}function zt(r){for(const t of document.elementsFromPoint(r.x,r.y))if(t instanceof HTMLElement){const e=It(t);if(e)return e}return null}function Mt(r,t,e){const s=[];let i;const o=V(()=>i?{x:i.offsetWidth,y:i.offsetHeight}:null),a=V((d,x)=>{if(s.length>0){if(d.x>=x)return null;const D=d.y*x+d.x;if(D>=0&&D<s.length)return{x:s[D].offsetLeft,y:s[D].offsetTop}}return null}),f=V((d,x)=>{if(s.length>0){const D=a.call(d,x),Y=a.call(M(d,G),x),Z=a.call(M(d,q),x),N=d.y*x+d.x;if(N<0||N>=s.length)return null;const L={x:s[N].offsetWidth,y:s[N].offsetHeight};return D&&Y&&(L.x=Y.x-D.x),D&&Z&&(L.y=Z.y-D.y),L}return null});function n(d){const x={x:d.clientX,y:d.clientY},D=zt(x);D&&(m.setDragFrom(D,x),e(3,m))}function u(d){const x={x:d.clientX,y:d.clientY};m.dragUpdate(x),e(3,m)}function c(d){m.unsetDragFrom(),e(3,m)}let{tileCount:h}=t,{image:g}=t,{showBorders:l}=t,m=new Pt({tileCount:h,image:g,getGridSize:o.call,getSlotPos:a.call,getSlotSize:f.call});m.shuffle();function A(){m.shuffle(),e(3,m)}function p(){o.clear(),a.clear(),f.clear(),e(3,m)}dt(()=>(e(3,m),window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}));function y(d,x){U[d?"unshift":"push"](()=>{s[x]=d,e(1,s)})}function k(d){U[d?"unshift":"push"](()=>{i=d,e(2,i)})}return r.$$set=d=>{"tileCount"in d&&e(7,h=d.tileCount),"image"in d&&e(8,g=d.image),"showBorders"in d&&e(0,l=d.showBorders)},[l,s,i,m,n,u,c,h,g,A,y,k]}class Bt extends ot{constructor(t){super(),nt(this,t,Mt,Et,st,{tileCount:7,image:8,showBorders:0,shuffle:9})}get shuffle(){return this.$$.ctx[9]}}function Nt(r){let t,e,s,i,o="Shuffle",a,f,n,u,c,h="Show borders",g,l,m,A={showBorders:r[1],tileCount:r[2],image:r[3]};return t=new Bt({props:A}),r[4](t),{c(){lt(t.$$.fragment),e=P(),s=b("div"),i=b("button"),i.textContent=o,a=P(),f=b("div"),n=b("input"),u=P(),c=b("label"),c.textContent=h,this.h()},l(p){at(t.$$.fragment,p),e=E(p),s=C(p,"DIV",{class:!0});var y=T(s);i=C(y,"BUTTON",{"data-svelte-h":!0}),J(i)!=="svelte-16udwzv"&&(i.textContent=o),a=E(y),f=C(y,"DIV",{});var k=T(f);n=C(k,"INPUT",{id:!0,type:!0}),u=E(k),c=C(k,"LABEL",{for:!0,"data-svelte-h":!0}),J(c)!=="svelte-1wpteno"&&(c.textContent=h),k.forEach(w),y.forEach(w),this.h()},h(){_(n,"id","boder-checkbox"),_(n,"type","checkbox"),_(c,"for","boder-checkbox"),_(s,"class","toolbar svelte-10goblz")},m(p,y){ut(t,p,y),O(p,e,y),O(p,s,y),S(s,i),S(s,a),S(s,f),S(f,n),n.checked=r[1],S(f,u),S(f,c),g=!0,l||(m=[z(i,"click",r[5]),z(n,"change",r[6])],l=!0)},p(p,y){const k={};y&2&&(k.showBorders=p[1]),t.$set(k),y&2&&(n.checked=p[1])},i(p){g||(ht(t.$$.fragment,p),g=!0)},o(p){ft(t.$$.fragment,p),g=!1},d(p){p&&(w(e),w(s)),r[4](null),ct(t,p),l=!1,it(m)}}}function Wt(r){let t,e,s;return e=new wt({props:{$$slots:{default:[Nt]},$$scope:{ctx:r}}}),{c(){t=P(),lt(e.$$.fragment),this.h()},l(i){_t("svelte-o5nfkw",document.head).forEach(w),t=E(i),at(e.$$.fragment,i),this.h()},h(){document.title="Play - Picture slicer multi"},m(i,o){O(i,t,o),ut(e,i,o),s=!0},p(i,[o]){const a={};o&515&&(a.$$scope={dirty:o,ctx:i}),e.$set(a)},i(i){s||(ht(e.$$.fragment,i),s=!0)},o(i){ft(e.$$.fragment,i),s=!1},d(i){i&&w(t),ct(e,i)}}}function Rt(r,t,e){let s;pt(r,xt,g=>e(7,s=g));const i=parseInt(s.url.searchParams.get("n")??"100"),o=parseInt(s.url.searchParams.get("i")??"0"),a=Dt[o];let f,n;function u(g){U[g?"unshift":"push"](()=>{f=g,e(0,f)})}const c=()=>f.shuffle();function h(){n=this.checked,e(1,n)}return[f,n,i,a,u,c,h]}class Ut extends ot{constructor(t){super(),nt(this,t,Rt,Wt,st,{})}}export{Ut as component};
