var Ft=Object.defineProperty;var St=(i,t,e)=>t in i?Ft(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var O=(i,t,e)=>St(i,typeof t!="symbol"?t+"":t,e);import{s as mt,n as rt,r as bt,o as Ct,e as z,c as Ot,x as X}from"../chunks/scheduler.CcFN-_cZ.js";import{S as _t,i as pt,e as T,s as q,c as M,a as B,d as x,f as A,v as k,B as b,g as I,h as C,C as et,k as wt,l as Pt,m as yt,n as Dt,o as vt,p as xt,q as kt,D as Y,t as N,b as W,j as $,x as Tt}from"../chunks/index.Csv5Vs4x.js";import{b as Mt}from"../chunks/paths.DilmqUo0.js";import{p as It}from"../chunks/stores.lIeGVmng.js";import{s as Et,e as U,u as ot,d as nt,S as zt,i as Bt}from"../chunks/image.D0jFKXzh.js";const Nt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function V(i,t){return L(i,t,(e,s)=>e+s)}function G(i,t){return L(i,t,(e,s)=>e-s)}function Wt(i,t){let e=i;return t.min&&(e=L(e,t.min,Math.max)),t.max&&(e=L(e,t.max,Math.min)),e}function Rt(i,t){return L(i,t,(e,s)=>e/s)}function qt(i){return At(i,Math.round)}function R(i,t){return i.x==t.x&&i.y==t.y}function At(i,t){return{x:t(i.x),y:t(i.y)}}function L(i,t,e){return{x:e(i.x,t.x),y:e(i.y,t.y)}}function tt(i){const t=new Map;return{call:(...e)=>{const s=JSON.stringify(e),r=t.get(s);if(r)return r;{const a=i(...e);return t.set(s,a),a}},clear:()=>{t.clear()}}}function Gt(i){let t=i.length,e;for(;t!=0;)e=Math.floor(Math.random()*t),t--,[i[t],i[e]]=[i[e],i[t]]}class Vt{constructor(t,e,s){O(this,"matrix");O(this,"initial");O(this,"current");O(this,"drag");this.matrix=s,this.initial={x:t,y:e},this.current={x:t,y:e},this.drag={from:null,to:null}}get rows(){return this.matrix.rows}get cols(){return this.matrix.cols}get image(){return this.matrix.image}isDragFrom(){return this.drag.from!=null}isDragTo(){return this.drag.to!=null}originOrCurrent(){var t,e;return((t=this.drag.from)==null?void 0:t.originCurrent)??((e=this.drag.to)==null?void 0:e.originCurrent)??this.current}getNext(t){return this.matrix.tileByCurrent(V(this.current,t))}isAtInitial(){return R(this.current,this.initial)}isOkWith(t){return R(G(t.current,this.current),G(t.initial,this.initial))}isOkWithNext(t){const e=this.getNext(t);return e?e.isOkWith(this):!0}setDragFrom(t){if(this.drag.from!=null)throw new Error("setDragFrom: from already set");if(this.drag.to!=null)throw new Error("setDragFrom: to already set");if(!this.matrix.options.getSlotPos(this.current,this.cols))throw new Error("setDragFrom: slot not found");this.drag.from={originCurrent:this.current,originMouse:t,pullOffset:{x:0,y:0}}}updateDragFrom(t){if(this.drag.from==null)throw new Error("updateDragFrom: from unset");const e=G(t,this.drag.from.originMouse);this.drag.from.pullOffset=e}unsetDragFrom(){if(this.drag.from==null)throw new Error("unsetDragFrom: from unset");this.drag.from=null}setDragTo(){if(this.drag.from!=null)throw new Error("setDragTo: from already set");if(this.drag.to!=null)throw new Error("setDragTo: to already set");this.drag.to={originCurrent:this.current}}unsetDragTo(){if(this.drag.to==null)throw new Error("unsetDragTo: to unset");this.current=this.drag.to.originCurrent,this.drag.to=null}cancelDrag(){this.drag.from&&(this.current=this.drag.from.originCurrent,this.unsetDragFrom()),this.drag.to&&this.unsetDragTo()}style(){var u,o,g;const t=this.matrix.options.getGridSize(),e=this.matrix.options.getSlotPos(this.initial,this.cols);let s;this.isDragFrom()?s=this.originOrCurrent():s=this.current;const r=this.matrix.options.getSlotPos(s,this.cols),a=this.matrix.options.getSlotSize(s,this.cols);if(t&&e&&r&&a){let n={...e};n.x=Math.min(n.x,t.x-a.x),n.x=Math.max(n.x,0),n.x=n.x*-1,n.y=Math.min(n.y,t.y-a.y),n.y=Math.max(n.y,0),n.y=n.y*-1;const p=t;return`left: ${r.x+(((u=this.drag.from)==null?void 0:u.pullOffset.x)??0)}px; top: ${r.y+(((g=(o=this.drag.from)==null?void 0:o.pullOffset)==null?void 0:g.y)??0)}px; width: ${a.x}px; height: ${a.y}px;background-image: url(${this.image.url}); background-position: ${n.x}px ${n.y}px; background-size: ${p.x}px ${p.y}px ; `}}}const it={x:0,y:-1},j={x:0,y:1},st={x:-1,y:0},J={x:1,y:0},Lt=[it,j,st,J];class Ht{constructor(t){O(this,"options");O(this,"rows");O(this,"cols");O(this,"matrix",[]);O(this,"dragFrom",null);this.options=t;let e=Et(t.image.size,t.tileCount);this.cols=e.x,this.rows=e.y,this.matrix=[];for(let s=0;s<this.rows;s++)for(let r=0;r<this.cols;r++)this.matrix.push(new Vt(r,s,this))}get image(){return this.options.image}*tiles(){for(const t of this.matrix)yield t}tileGroup(t){const e=new Set;function s(r){if(!e.has(r)){e.add(r);for(const a of Lt){const u=r.getNext(a);u&&r.isOkWith(u)&&s(u)}}}return s(t),e}tileByInitial(t){return this.isInRange(t)?this.matrix[t.y*this.cols+t.x]:null}isInRange(t){return t.x>=0&&t.x<this.cols&&t.y>=0&&t.y<this.rows}tileByCurrent(t){for(const e of this.matrix)if(R(e.current,t))return e;return null}tileByOriginCurrent(t){for(const e of this.matrix)if(R(e.originOrCurrent(),t))return e;return null}style(){return`aspect-ratio: ${this.image.size.x} / ${this.image.size.y}; grid-template-columns: repeat(${this.cols}, 1fr);`}shuffle(){const t=[...this.matrix.map(e=>({...e.current}))];Gt(t);for(const e in this.matrix)this.matrix[e].current=t[e]}solveDrag(t,e){const s=[];if(e.x!=0||e.y!=0){const r=[];for(const a of t){const u=V(a.current,e);if(!this.isInRange(u))return[];r.push({pos:u,tile:a})}for(const{pos:a,tile:u}of r){s.push({tile:u,pos:a,isDragTo:!1});const o=this.tileByOriginCurrent(a);if(o&&!t.includes(o)){let g,n,p=u,w=0;do{g=p.originOrCurrent(),n=!0;for(const{pos:F,tile:D}of r)if(R(F,g)){n=!1,p=D;break}if(w++,w>1e3)throw new Error("infinite loop")}while(!n);s.push({tile:o,pos:g,isDragTo:!0})}}}return s}isSolved(){for(const t of this.matrix)if(!t.isAtInitial())return!1;return!0}setDragFrom(t,e){const s=this.tileByOriginCurrent(t);if(s){const r=[...this.tileGroup(s)];this.dragFrom={startClient:e,startPos:t,currentPos:t,tiles:r,dragActions:[]},r.map(a=>a.setDragFrom(e))}}isDragging(){return this.dragFrom!=null}dragUpdate(t){var s;const e=this.options.getSlotSize(this.matrix[0].current,this.cols);if(e&&this.dragFrom){const r=G(t,this.dragFrom.startClient),a=qt(Rt(r,e)),u=Wt(V(this.dragFrom.startPos,a),{min:{x:0,y:0},max:{x:this.cols-1,y:this.rows-1}}),o=G(u,this.dragFrom.currentPos);this.dragFrom.currentPos=u;const g=this.solveDrag(this.dragFrom.tiles,o);g.length!=0&&(this.dragFrom.dragActions.map(n=>{n.isDragTo&&n.tile.unsetDragTo()}),this.dragFrom.dragActions=g,this.dragFrom.dragActions.map(n=>{n.isDragTo?n.tile.setDragTo():n.tile.updateDragFrom(t),n.tile.current=n.pos})),(s=this.dragFrom)==null||s.tiles.map(n=>{n.updateDragFrom(t)})}}unsetDragFrom(t){var s,r,a,u;let e;return t&&((s=this.dragFrom)!=null&&s.startPos)&&!R((r=this.dragFrom)==null?void 0:r.startPos,t)?e=!0:e=!1,(a=this.dragFrom)==null||a.tiles.map(o=>o.unsetDragFrom()),(u=this.dragFrom)==null||u.dragActions.map(o=>{o.isDragTo&&o.tile.unsetDragTo(),o.tile.current=o.pos}),this.dragFrom=null,e}cancelDrag(){this.matrix.forEach(t=>t.cancelDrag()),this.dragFrom=null}}const{window:lt}=Nt;function at(i,t,e){const s=i.slice();return s[20]=t[e],s}function ut(i,t,e){const s=i.slice();return s[20]=t[e],s[23]=t,s[24]=e,s}function ft(i,t){let e,s,r,a=t[24];const u=()=>t[14](e,a),o=()=>t[14](null,a);return{key:i,first:null,c(){e=T("div"),this.h()},l(g){e=M(g,"DIV",{class:!0,"data-pos-x":!0,"data-pos-y":!0}),B(e).forEach(x),this.h()},h(){k(e,"class","slot svelte-411q9w"),k(e,"data-pos-x",s=t[20].initial.x),k(e,"data-pos-y",r=t[20].initial.y),this.first=e},m(g,n){I(g,e,n),u()},p(g,n){t=g,n&8&&s!==(s=t[20].initial.x)&&k(e,"data-pos-x",s),n&8&&r!==(r=t[20].initial.y)&&k(e,"data-pos-y",r),a!==t[24]&&(o(),a=t[24],u())},d(g){g&&x(e),o()}}}function ct(i,t){let e,s,r,a;return{key:i,first:null,c(){e=T("div"),this.h()},l(u){e=M(u,"DIV",{class:!0,style:!0}),B(e).forEach(x),this.h()},h(){k(e,"class","tile svelte-411q9w"),k(e,"style",s=t[20].style()),b(e,"drag-from",t[20].isDragFrom()),b(e,"top-ok",t[20].isOkWithNext(it)),b(e,"bottom-ok",t[20].isOkWithNext(j)),b(e,"left-ok",t[20].isOkWithNext(st)),b(e,"right-ok",t[20].isOkWithNext(J)),this.first=e},m(u,o){I(u,e,o),r||(a=et(e,"mousedown",t[4]),r=!0)},p(u,o){t=u,o&8&&s!==(s=t[20].style())&&k(e,"style",s),o&8&&b(e,"drag-from",t[20].isDragFrom()),o&8&&b(e,"top-ok",t[20].isOkWithNext(it)),o&8&&b(e,"bottom-ok",t[20].isOkWithNext(j)),o&8&&b(e,"left-ok",t[20].isOkWithNext(st)),o&8&&b(e,"right-ok",t[20].isOkWithNext(J))},d(u){u&&x(e),r=!1,a()}}}function Xt(i){let t,e,s=[],r=new Map,a,u,o=[],g=new Map,n,p,w=U([...i[3].tiles()]);const F=h=>h[20];for(let h=0;h<w.length;h+=1){let d=ut(i,w,h),_=F(d);r.set(_,s[h]=ft(_,d))}let D=U([...i[3].tiles()]);const v=h=>h[20];for(let h=0;h<D.length;h+=1){let d=at(i,D,h),_=v(d);g.set(_,o[h]=ct(_,d))}return{c(){t=T("div"),e=T("div");for(let h=0;h<s.length;h+=1)s[h].c();u=q();for(let h=0;h<o.length;h+=1)o[h].c();this.h()},l(h){t=M(h,"DIV",{class:!0});var d=B(t);e=M(d,"DIV",{class:!0,style:!0});var _=B(e);for(let c=0;c<s.length;c+=1)s[c].l(_);_.forEach(x),u=A(d);for(let c=0;c<o.length;c+=1)o[c].l(d);d.forEach(x),this.h()},h(){k(e,"class","grid svelte-411q9w"),k(e,"style",a=i[3].style()),k(t,"class","stack svelte-411q9w"),b(t,"show-borders",i[0])},m(h,d){I(h,t,d),C(t,e);for(let _=0;_<s.length;_+=1)s[_]&&s[_].m(e,null);i[15](e),C(t,u);for(let _=0;_<o.length;_+=1)o[_]&&o[_].m(t,null);n||(p=[et(lt,"mouseup",i[6]),et(lt,"mousemove",i[5])],n=!0)},p(h,[d]){d&10&&(w=U([...h[3].tiles()]),s=ot(s,d,F,1,h,w,r,e,nt,ft,null,ut)),d&8&&a!==(a=h[3].style())&&k(e,"style",a),d&24&&(D=U([...h[3].tiles()]),o=ot(o,d,v,1,h,D,g,t,nt,ct,null,at)),d&1&&b(t,"show-borders",h[0])},i:rt,o:rt,d(h){h&&x(t);for(let d=0;d<s.length;d+=1)s[d].d();i[15](null);for(let d=0;d<o.length;d+=1)o[d].d();n=!1,bt(p)}}}function Yt(i){if(i.dataset.posX&&i.dataset.posY){const t=Number(i.dataset.posX),e=Number(i.dataset.posY);return{x:t,y:e}}else return null}function ht(i){for(const t of document.elementsFromPoint(i.x,i.y))if(t instanceof HTMLElement){const e=Yt(t);if(e)return e}return null}function Ut(i,t,e){let{tileCount:s}=t,{image:r}=t,{showBorders:a}=t,{actionCount:u=0}=t,{rows:o=0}=t,{cols:g=0}=t,{isSolved:n=!1}=t;const p=[];let w;const F=tt(()=>w?{x:w.offsetWidth,y:w.offsetHeight}:null),D=tt((l,m)=>{if(p.length>0){if(l.x>=m)return null;const f=l.y*m+l.x;if(f>=0&&f<p.length)return{x:p[f].offsetLeft,y:p[f].offsetTop}}return null}),v=tt((l,m)=>{if(p.length>0){const f=D.call(l,m),y=D.call(V(l,J),m),S=D.call(V(l,j),m),P=l.y*m+l.x;if(P<0||P>=p.length)return null;const Q={x:p[P].offsetWidth,y:p[P].offsetHeight};return f&&y&&(Q.x=y.x-f.x),f&&S&&(Q.y=S.y-f.y),Q}return null});function h(l){if(!n)if(c.isDragging())c.cancelDrag(),e(3,c);else{const m={x:l.clientX,y:l.clientY},f=ht(m);f&&(c.setDragFrom(f,m),e(3,c))}}function d(l){if(n||!c.isDragging())return;const m={x:l.clientX,y:l.clientY};c.dragUpdate(m),e(3,c)}function _(l){if(n||!c.isDragging())return;const m={x:l.clientX,y:l.clientY},f=ht(m);c.unsetDragFrom(f)&&e(7,u+=1),e(3,c),e(10,n=c.isSolved())}let c=new Ht({tileCount:s,image:r,getGridSize:F.call,getSlotPos:D.call,getSlotSize:v.call});c.shuffle();function Z(){c.shuffle(),e(3,c),e(10,n=c.isSolved())}function H(){F.clear(),D.clear(),v.clear(),e(3,c)}Ct(()=>(e(3,c),e(10,n=c.isSolved()),e(8,o=c.rows),e(9,g=c.cols),window.addEventListener("resize",H),()=>{window.removeEventListener("resize",H)}));function K(l,m){z[l?"unshift":"push"](()=>{p[m]=l,e(1,p)})}function E(l){z[l?"unshift":"push"](()=>{w=l,e(2,w)})}return i.$$set=l=>{"tileCount"in l&&e(11,s=l.tileCount),"image"in l&&e(12,r=l.image),"showBorders"in l&&e(0,a=l.showBorders),"actionCount"in l&&e(7,u=l.actionCount),"rows"in l&&e(8,o=l.rows),"cols"in l&&e(9,g=l.cols),"isSolved"in l&&e(10,n=l.isSolved)},[a,p,w,c,h,d,_,u,o,g,n,s,r,Z,K,E]}class jt extends _t{constructor(t){super(),pt(this,t,Ut,Xt,mt,{tileCount:11,image:12,showBorders:0,actionCount:7,rows:8,cols:9,isSolved:10,shuffle:13})}get shuffle(){return this.$$.ctx[13]}}function gt(i){let t,e=`Solved âœ¨ <a href="${Mt}">Play again</a>`;return{c(){t=T("div"),t.innerHTML=e},l(s){t=M(s,"DIV",{"data-svelte-h":!0}),Tt(t)!=="svelte-cmma27"&&(t.innerHTML=e)},m(s,r){I(s,t,r)},d(s){s&&x(t)}}}function dt(i){let t;return{c(){t=N("s")},l(e){t=W(e,"s")},m(e,s){I(e,t,s)},d(e){e&&x(t)}}}function Jt(i){let t,e,s,r,a,u,o,g,n,p,w,F,D,v,h,d,_;function c(f){i[9](f)}function Z(f){i[10](f)}function H(f){i[11](f)}function K(f){i[12](f)}let E={showBorders:i[7],tileCount:i[5],image:i[6]};i[1]!==void 0&&(E.rows=i[1]),i[2]!==void 0&&(E.cols=i[2]),i[0]!==void 0&&(E.actionCount=i[0]),i[3]!==void 0&&(E.isSolved=i[3]),t=new jt({props:E}),i[8](t),z.push(()=>Y(t,"rows",c)),z.push(()=>Y(t,"cols",Z)),z.push(()=>Y(t,"actionCount",H)),z.push(()=>Y(t,"isSolved",K));let l=i[3]&&gt(),m=i[0]>1&&dt();return{c(){wt(t.$$.fragment),u=q(),o=T("div"),g=T("div"),n=N(i[1]),p=N(" x "),w=N(i[2]),F=q(),l&&l.c(),D=q(),v=T("div"),h=N(i[0]),d=N(" move"),m&&m.c(),this.h()},l(f){yt(t.$$.fragment,f),u=A(f),o=M(f,"DIV",{class:!0});var y=B(o);g=M(y,"DIV",{class:!0});var S=B(g);n=W(S,i[1]),p=W(S," x "),w=W(S,i[2]),S.forEach(x),F=A(y),l&&l.l(y),D=A(y),v=M(y,"DIV",{class:!0});var P=B(v);h=W(P,i[0]),d=W(P," move"),m&&m.l(P),P.forEach(x),y.forEach(x),this.h()},h(){k(g,"class","muted svelte-cx25hv"),k(v,"class","muted svelte-cx25hv"),k(o,"class","toolbar svelte-cx25hv")},m(f,y){Dt(t,f,y),I(f,u,y),I(f,o,y),C(o,g),C(g,n),C(g,p),C(g,w),C(o,F),l&&l.m(o,null),C(o,D),C(o,v),C(v,h),C(v,d),m&&m.m(v,null),_=!0},p(f,y){const S={};!e&&y&2&&(e=!0,S.rows=f[1],X(()=>e=!1)),!s&&y&4&&(s=!0,S.cols=f[2],X(()=>s=!1)),!r&&y&1&&(r=!0,S.actionCount=f[0],X(()=>r=!1)),!a&&y&8&&(a=!0,S.isSolved=f[3],X(()=>a=!1)),t.$set(S),(!_||y&2)&&$(n,f[1]),(!_||y&4)&&$(w,f[2]),f[3]?l||(l=gt(),l.c(),l.m(o,D)):l&&(l.d(1),l=null),(!_||y&1)&&$(h,f[0]),f[0]>1?m||(m=dt(),m.c(),m.m(v,null)):m&&(m.d(1),m=null)},i(f){_||(vt(t.$$.fragment,f),_=!0)},o(f){xt(t.$$.fragment,f),_=!1},d(f){f&&(x(u),x(o)),i[8](null),kt(t,f),l&&l.d(),m&&m.d()}}}function Zt(i){let t,e,s;return e=new zt({props:{$$slots:{default:[Jt]},$$scope:{ctx:i}}}),{c(){t=q(),wt(e.$$.fragment),this.h()},l(r){Pt("svelte-66crdv",document.head).forEach(x),t=A(r),yt(e.$$.fragment,r),this.h()},h(){document.title="Play - Picture slicer"},m(r,a){I(r,t,a),Dt(e,r,a),s=!0},p(r,[a]){const u={};a&32799&&(u.$$scope={dirty:a,ctx:r}),e.$set(u)},i(r){s||(vt(e.$$.fragment,r),s=!0)},o(r){xt(e.$$.fragment,r),s=!1},d(r){r&&x(t),kt(e,r)}}}function Kt(i,t,e){let s;Ot(i,It,c=>e(13,s=c));const r=parseInt(s.url.searchParams.get("n")??"100"),a=parseInt(s.url.searchParams.get("i")??"0"),u=Bt[a];let o,g,n,p,w,F;function D(c){z[c?"unshift":"push"](()=>{w=c,e(4,w)})}function v(c){g=c,e(1,g)}function h(c){n=c,e(2,n)}function d(c){o=c,e(0,o)}function _(c){p=c,e(3,p)}return[o,g,n,p,w,r,u,F,D,v,h,d,_]}class re extends _t{constructor(t){super(),pt(this,t,Kt,Zt,mt,{})}}export{re as component};
