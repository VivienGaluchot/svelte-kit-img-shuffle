var gt=Object.defineProperty;var mt=(r,t,e)=>t in r?gt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var F=(r,t,e)=>(mt(r,typeof t!="symbol"?t+"":t,e),e);import{S as st,i as it,s as ot,k as b,a as C,l as S,m as O,h as y,c as E,n as x,R as v,b as P,F as k,N as z,J,O as K,P as nt,o as dt,T as pt,w as V,y as lt,D as _t,z as at,A as ut,g as ht,d as ct,B as ft,K as xt,q as Z,r as $}from"../chunks/index.e3b305be.js";import{p as yt}from"../chunks/stores.18e965ac.js";import{s as wt,S as Dt,i as vt}from"../chunks/image.c9fe6cb3.js";function M(r,t){return B(r,t,(e,s)=>e+s)}function I(r,t){return B(r,t,(e,s)=>e-s)}function Ft(r,t){let e=r;return t.min&&(e=B(e,t.min,Math.max)),t.max&&(e=B(e,t.max,Math.min)),e}function kt(r,t){return B(r,t,(e,s)=>e/s)}function bt(r){return St(r,Math.round)}function W(r,t){return r.x==t.x&&r.y==t.y}function St(r,t){return{x:t(r.x),y:t(r.y)}}function B(r,t,e){return{x:e(r.x,t.x),y:e(r.y,t.y)}}function L(r){const t=new Map;return{call:(...e)=>{const s=t.get(e);if(s)return s;{const i=r(...e);return t.set(e,i),i}},clear:()=>{t.clear()}}}function Ot(r){let t=r.length,e;for(;t!=0;)e=Math.floor(Math.random()*t),t--,[r[t],r[e]]=[r[e],r[t]]}class Tt{constructor(t,e,s){F(this,"matrix");F(this,"initial");F(this,"current");F(this,"drag");this.matrix=s,this.initial={x:t,y:e},this.current={x:t,y:e},this.drag={from:null,to:null}}get rows(){return this.matrix.rows}get cols(){return this.matrix.cols}get image(){return this.matrix.image}isDragFrom(){return this.drag.from!=null}isDragTo(){return this.drag.to!=null}originOrCurrent(){var t,e;return((t=this.drag.from)==null?void 0:t.originCurrent)??((e=this.drag.to)==null?void 0:e.originCurrent)??this.current}getNext(t){return this.matrix.tileByCurrent(M(this.current,t))}isOkWith(t){return W(I(t.current,this.current),I(t.initial,this.initial))}isOkWithNext(t){const e=this.getNext(t);return e?e.isOkWith(this):!0}setDragFrom(t){if(this.drag.from!=null)throw new Error("setDragFrom: from already set");if(this.drag.to!=null)throw new Error("setDragFrom: to already set");if(!this.matrix.options.getSlotPos(this.current,this.cols))throw new Error("setDragFrom: slot not found");this.drag.from={originCurrent:this.current,originMouse:t,pullOffset:{x:0,y:0}}}updateDragFrom(t){if(this.drag.from==null)throw new Error("updateDragFrom: from unset");const e=I(t,this.drag.from.originMouse);this.drag.from.pullOffset=e}unsetDragFrom(){if(this.drag.from==null)throw new Error("unsetDragFrom: from unset");this.drag.from=null}setDragTo(){if(this.drag.from!=null)throw new Error("setDragTo: from already set");if(this.drag.to!=null)throw new Error("setDragTo: to already set");this.drag.to={originCurrent:this.current}}unsetDragTo(){if(this.drag.to==null)throw new Error("unsetDragTo: to unset");this.current=this.drag.to.originCurrent,this.drag.to=null}style(){var a,c,n;const t=this.matrix.options.getGridSize(),e=this.matrix.options.getSlotPos(this.initial,this.cols);let s;this.isDragFrom()?s=this.originOrCurrent():s=this.current;const i=this.matrix.options.getSlotPos(s,this.cols),o=this.matrix.options.getSlotSize(s,this.cols);if(t&&e&&i&&o){let h={...e};h.x=Math.min(h.x,t.x-o.x),h.x=Math.max(h.x,0),h.x=h.x*-1,h.y=Math.min(h.y,t.y-o.y),h.y=Math.max(h.y,0),h.y=h.y*-1;const f=t;return`left: ${i.x+(((a=this.drag.from)==null?void 0:a.pullOffset.x)??0)}px; top: ${i.y+(((n=(c=this.drag.from)==null?void 0:c.pullOffset)==null?void 0:n.y)??0)}px; width: ${o.x}px; height: ${o.y}px;background-image: url(${this.image.url}); background-position: ${h.x}px ${h.y}px; background-size: ${f.x}px ${f.y}px ; `}}}const U={x:0,y:-1},R={x:0,y:1},H={x:-1,y:0},q={x:1,y:0},Pt=[U,R,H,q];class Ct{constructor(t){F(this,"options");F(this,"rows");F(this,"cols");F(this,"matrix",[]);F(this,"dragFrom",null);F(this,"dragTarget",null);this.options=t;let e=wt(t.image.size,t.tileCount);this.cols=e.x,this.rows=e.y,this.matrix=[];for(let s=0;s<this.rows;s++)for(let i=0;i<this.cols;i++)this.matrix.push(new Tt(i,s,this))}get image(){return this.options.image}*tiles(){for(const t of this.matrix)yield t}tileGroup(t){const e=new Set;function s(i){if(!e.has(i)){e.add(i);for(const o of Pt){const a=i.getNext(o);a&&i.isOkWith(a)&&s(a)}}}return s(t),e}tileByInitial(t){return this.isInRange(t)?this.matrix[t.y*this.cols+t.x]:null}isInRange(t){return t.x>=0&&t.x<this.cols&&t.y>=0&&t.y<this.rows}tileByCurrent(t){for(const e of this.matrix)if(W(e.current,t))return e;return null}tileByOriginCurrent(t){for(const e of this.matrix)if(W(e.originOrCurrent(),t))return e;return null}style(){return`aspect-ratio: ${this.image.size.x} / ${this.image.size.y}; grid-template-columns: repeat(${this.cols}, 1fr);`}shuffle(){const t=[...this.matrix.map(e=>({...e.current}))];Ot(t);for(const e in this.matrix)this.matrix[e].current=t[e]}solveDrag(t,e){const s=[];if(e.x!=0||e.y!=0){const i=[];for(const o of t){const a=M(o.current,e);if(!this.isInRange(a))return[];i.push({pos:a,tile:o})}for(const{pos:o,tile:a}of i){s.push({tile:a,pos:o,isDragTo:!1});const c=this.tileByOriginCurrent(o);if(c&&!t.includes(c)){let n,h,f=a,u=0;do{n=f.originOrCurrent(),h=!0;for(const{pos:m,tile:l}of i)if(W(m,n)){h=!1,f=l;break}if(u++,u>1e3)throw new Error("infinite loop")}while(!h);s.push({tile:c,pos:n,isDragTo:!0})}}}return s}setDragFrom(t,e){const s=this.tileByOriginCurrent(t);if(s){const i=[...this.tileGroup(s)];this.dragFrom={startClient:e,startPos:t,currentPos:t,tiles:i,dragActions:[]},i.map(o=>o.setDragFrom(e))}}dragUpdate(t){var s;const e=this.options.getSlotSize(this.matrix[0].current,this.cols);if(e&&this.dragFrom){const i=I(t,this.dragFrom.startClient),o=bt(kt(i,e)),a=Ft(M(this.dragFrom.startPos,o),{min:{x:0,y:0},max:{x:this.cols-1,y:this.rows-1}}),c=I(a,this.dragFrom.currentPos);this.dragFrom.currentPos=a;const n=this.solveDrag(this.dragFrom.tiles,c);n.length!=0&&(this.dragFrom.dragActions.map(h=>{h.isDragTo&&h.tile.unsetDragTo()}),this.dragFrom.dragActions=n,this.dragFrom.dragActions.map(h=>{h.isDragTo?h.tile.setDragTo():h.tile.updateDragFrom(t),h.tile.current=h.pos})),(s=this.dragFrom)==null||s.tiles.map(h=>{h.updateDragFrom(t)})}}unsetDragFrom(){var t,e;(t=this.dragFrom)==null||t.tiles.map(s=>s.unsetDragFrom()),(e=this.dragFrom)==null||e.dragActions.map(s=>{s.isDragTo&&s.tile.unsetDragTo(),s.tile.current=s.pos}),this.dragFrom=null,this.dragTarget=null}}const{window:j}=pt;function Q(r,t,e){const s=r.slice();return s[16]=t[e],s}function tt(r,t,e){const s=r.slice();return s[16]=t[e],s[19]=t,s[20]=e,s}function et(r){let t,e,s,i=r[20];const o=()=>r[10](t,i),a=()=>r[10](null,i);return{c(){t=b("div"),this.h()},l(c){t=S(c,"DIV",{class:!0,"data-pos-x":!0,"data-pos-y":!0}),O(t).forEach(y),this.h()},h(){x(t,"class","slot svelte-411q9w"),x(t,"data-pos-x",e=r[16].initial.x),x(t,"data-pos-y",s=r[16].initial.y)},m(c,n){P(c,t,n),o()},p(c,n){r=c,n&8&&e!==(e=r[16].initial.x)&&x(t,"data-pos-x",e),n&8&&s!==(s=r[16].initial.y)&&x(t,"data-pos-y",s),i!==r[20]&&(a(),i=r[20],o())},d(c){c&&y(t),a()}}}function rt(r){let t,e,s,i;return{c(){t=b("div"),this.h()},l(o){t=S(o,"DIV",{class:!0,style:!0}),O(t).forEach(y),this.h()},h(){x(t,"class","tile svelte-411q9w"),x(t,"style",e=r[16].style()),v(t,"drag-from",r[16].isDragFrom()),v(t,"top-ok",r[16].isOkWithNext(U)),v(t,"bottom-ok",r[16].isOkWithNext(R)),v(t,"left-ok",r[16].isOkWithNext(H)),v(t,"right-ok",r[16].isOkWithNext(q))},m(o,a){P(o,t,a),s||(i=z(t,"mousedown",r[4]),s=!0)},p(o,a){a&8&&e!==(e=o[16].style())&&x(t,"style",e),a&8&&v(t,"drag-from",o[16].isDragFrom()),a&8&&v(t,"top-ok",o[16].isOkWithNext(U)),a&8&&v(t,"bottom-ok",o[16].isOkWithNext(R)),a&8&&v(t,"left-ok",o[16].isOkWithNext(H)),a&8&&v(t,"right-ok",o[16].isOkWithNext(q))},d(o){o&&y(t),s=!1,i()}}}function Et(r){let t,e,s,i,o,a,c=[...r[3].tiles()],n=[];for(let u=0;u<c.length;u+=1)n[u]=et(tt(r,c,u));let h=[...r[3].tiles()],f=[];for(let u=0;u<h.length;u+=1)f[u]=rt(Q(r,h,u));return{c(){t=b("div"),e=b("div");for(let u=0;u<n.length;u+=1)n[u].c();i=C();for(let u=0;u<f.length;u+=1)f[u].c();this.h()},l(u){t=S(u,"DIV",{class:!0});var m=O(t);e=S(m,"DIV",{class:!0,style:!0});var l=O(e);for(let d=0;d<n.length;d+=1)n[d].l(l);l.forEach(y),i=E(m);for(let d=0;d<f.length;d+=1)f[d].l(m);m.forEach(y),this.h()},h(){x(e,"class","grid svelte-411q9w"),x(e,"style",s=r[3].style()),x(t,"class","stack svelte-411q9w"),v(t,"show-borders",r[0])},m(u,m){P(u,t,m),k(t,e);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null);r[11](e),k(t,i);for(let l=0;l<f.length;l+=1)f[l]&&f[l].m(t,null);o||(a=[z(j,"mouseup",r[6]),z(j,"mousemove",r[5])],o=!0)},p(u,[m]){if(m&10){c=[...u[3].tiles()];let l;for(l=0;l<c.length;l+=1){const d=tt(u,c,l);n[l]?n[l].p(d,m):(n[l]=et(d),n[l].c(),n[l].m(e,null))}for(;l<n.length;l+=1)n[l].d(1);n.length=c.length}if(m&8&&s!==(s=u[3].style())&&x(e,"style",s),m&24){h=[...u[3].tiles()];let l;for(l=0;l<h.length;l+=1){const d=Q(u,h,l);f[l]?f[l].p(d,m):(f[l]=rt(d),f[l].c(),f[l].m(t,null))}for(;l<f.length;l+=1)f[l].d(1);f.length=h.length}m&1&&v(t,"show-borders",u[0])},i:J,o:J,d(u){u&&y(t),K(n,u),r[11](null),K(f,u),o=!1,nt(a)}}}function It(r){if(r.dataset.posX&&r.dataset.posY){const t=Number(r.dataset.posX),e=Number(r.dataset.posY);return{x:t,y:e}}else return null}function zt(r){for(const t of document.elementsFromPoint(r.x,r.y))if(t instanceof HTMLElement){const e=It(t);if(e)return e}return null}function Mt(r,t,e){const s=[];let i;const o=L(()=>i?{x:i.offsetWidth,y:i.offsetHeight}:null),a=L((g,_)=>{if(s.length>0){if(g.x>=_)return null;const D=g.y*_+g.x;if(D>=0&&D<s.length)return{x:s[D].offsetLeft,y:s[D].offsetTop}}return null}),c=L((g,_)=>{if(s.length>0){const D=a.call(g,_),X=a.call(M(g,q),_),Y=a.call(M(g,R),_),N=g.y*_+g.x;if(N<0||N>=s.length)return null;const G={x:s[N].offsetWidth,y:s[N].offsetHeight};return D&&X&&(G.x=X.x-D.x),D&&Y&&(G.y=Y.y-D.y),G}return null});function n(g){const _={x:g.clientX,y:g.clientY},D=zt(_);D&&(d.setDragFrom(D,_),e(3,d))}function h(g){const _={x:g.clientX,y:g.clientY};d.dragUpdate(_),e(3,d)}function f(g){d.unsetDragFrom(),e(3,d)}let{tileCount:u}=t,{image:m}=t,{showBorders:l}=t,d=new Ct({tileCount:u,image:m,getGridSize:o.call,getSlotPos:a.call,getSlotSize:c.call});d.shuffle();function A(){d.shuffle(),e(3,d)}function p(){o.clear(),a.clear(),c.clear(),e(3,d)}dt(()=>(e(3,d),window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}));function w(g,_){V[g?"unshift":"push"](()=>{s[_]=g,e(1,s)})}function T(g){V[g?"unshift":"push"](()=>{i=g,e(2,i)})}return r.$$set=g=>{"tileCount"in g&&e(7,u=g.tileCount),"image"in g&&e(8,m=g.image),"showBorders"in g&&e(0,l=g.showBorders)},[l,s,i,d,n,h,f,u,m,A,w,T]}class Bt extends st{constructor(t){super(),it(this,t,Mt,Et,ot,{tileCount:7,image:8,showBorders:0,shuffle:9})}get shuffle(){return this.$$.ctx[9]}}function Nt(r){let t,e,s,i,o,a,c,n,h,f,u,m,l,d,A={showBorders:r[1],tileCount:r[2],image:r[3]};return t=new Bt({props:A}),r[4](t),{c(){lt(t.$$.fragment),e=C(),s=b("div"),i=b("button"),o=Z("Shuffle"),a=C(),c=b("div"),n=b("input"),h=C(),f=b("label"),u=Z("Show borders"),this.h()},l(p){at(t.$$.fragment,p),e=E(p),s=S(p,"DIV",{class:!0});var w=O(s);i=S(w,"BUTTON",{});var T=O(i);o=$(T,"Shuffle"),T.forEach(y),a=E(w),c=S(w,"DIV",{});var g=O(c);n=S(g,"INPUT",{id:!0,type:!0}),h=E(g),f=S(g,"LABEL",{for:!0});var _=O(f);u=$(_,"Show borders"),_.forEach(y),g.forEach(y),w.forEach(y),this.h()},h(){x(n,"id","boder-checkbox"),x(n,"type","checkbox"),x(f,"for","boder-checkbox"),x(s,"class","toolbar svelte-10goblz")},m(p,w){ut(t,p,w),P(p,e,w),P(p,s,w),k(s,i),k(i,o),k(s,a),k(s,c),k(c,n),n.checked=r[1],k(c,h),k(c,f),k(f,u),m=!0,l||(d=[z(i,"click",r[5]),z(n,"change",r[6])],l=!0)},p(p,w){const T={};w&2&&(T.showBorders=p[1]),t.$set(T),w&2&&(n.checked=p[1])},i(p){m||(ht(t.$$.fragment,p),m=!0)},o(p){ct(t.$$.fragment,p),m=!1},d(p){r[4](null),ft(t,p),p&&y(e),p&&y(s),l=!1,nt(d)}}}function Wt(r){let t,e,s;return e=new Dt({props:{$$slots:{default:[Nt]},$$scope:{ctx:r}}}),{c(){t=C(),lt(e.$$.fragment),this.h()},l(i){_t("svelte-o5nfkw",document.head).forEach(y),t=E(i),at(e.$$.fragment,i),this.h()},h(){document.title="Play - Picture slicer multi"},m(i,o){P(i,t,o),ut(e,i,o),s=!0},p(i,[o]){const a={};o&515&&(a.$$scope={dirty:o,ctx:i}),e.$set(a)},i(i){s||(ht(e.$$.fragment,i),s=!0)},o(i){ct(e.$$.fragment,i),s=!1},d(i){i&&y(t),ft(e,i)}}}function Rt(r,t,e){let s;xt(r,yt,m=>e(7,s=m));const i=parseInt(s.url.searchParams.get("n")??"100"),o=parseInt(s.url.searchParams.get("i")??"0"),a=vt[o];let c,n;function h(m){V[m?"unshift":"push"](()=>{c=m,e(0,c)})}const f=()=>c.shuffle();function u(){n=this.checked,e(1,n)}return[c,n,i,a,h,f,u]}class Vt extends st{constructor(t){super(),it(this,t,Rt,Wt,ot,{})}}export{Vt as component};
